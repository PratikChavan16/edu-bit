<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMS API Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .credentials { background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 5px; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #005a87; }
        .result { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; max-height: 400px; overflow-y: auto; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; width: 250px; }
        .token { word-break: break-all; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Bitflow LMS - API Testing Interface</h1>
    
    <div class="section">
        <h2>Available Test Accounts</h2>
        <div class="credentials">
            <strong>Admin:</strong> admin@medical.edu / admin123<br>
            <strong>Principal:</strong> principal@medical.edu / principal123<br>
            <strong>HOD:</strong> hod.pre@medical.edu / hod123<br>
            <strong>Teacher:</strong> teacher@medical.edu / teacher123<br>
            <strong>Student:</strong> student@medical.edu / student123
        </div>
    </div>

    <div class="section">
        <h2>Authentication Test</h2>
        <div>
            <input type="email" id="email" placeholder="Email" value="admin@medical.edu">
            <input type="password" id="password" placeholder="Password" value="admin123">
            <button onclick="login()">Login</button>
            <button onclick="logout()">Logout</button>
            <button onclick="getProfile()">Get Profile</button>
        </div>
        <div id="authResult" class="result"></div>
    </div>

    <div class="section">
        <h2>Data Fetch Tests</h2>
        <div>
            <button onclick="fetchData('/api/courses')">Get Courses</button>
            <button onclick="fetchData('/api/subjects')">Get Subjects</button>
            <button onclick="fetchData('/api/departments')">Get Departments</button>
            <button onclick="fetchData('/api/roles')">Get Roles</button>
        </div>
        <div id="dataResult" class="result"></div>
    </div>

    <script>
        let authToken = null;

        function displayResult(elementId, data) {
            document.getElementById(elementId).innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }

        function displayError(elementId, error) {
            document.getElementById(elementId).innerHTML = '<pre style="color: red;">' + error + '</pre>';
        }

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.data.token;
                    displayResult('authResult', {
                        message: 'Login successful!',
                        user: data.data.user,
                        token: data.data.token.substring(0, 50) + '...'
                    });
                } else {
                    displayError('authResult', 'Login failed: ' + JSON.stringify(data));
                }
            } catch (error) {
                displayError('authResult', 'Network error: ' + error.message);
            }
        }

        async function logout() {
            if (!authToken) {
                displayError('authResult', 'Please login first');
                return;
            }

            try {
                const response = await fetch('/api/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    authToken = null;
                    displayResult('authResult', data);
                } else {
                    displayError('authResult', 'Logout failed: ' + JSON.stringify(data));
                }
            } catch (error) {
                displayError('authResult', 'Network error: ' + error.message);
            }
        }

        async function getProfile() {
            if (!authToken) {
                displayError('authResult', 'Please login first');
                return;
            }

            try {
                const response = await fetch('/api/auth/me', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();
                displayResult('authResult', data);
            } catch (error) {
                displayError('authResult', 'Network error: ' + error.message);
            }
        }

        async function fetchData(endpoint) {
            if (!authToken) {
                displayError('dataResult', 'Please login first');
                return;
            }

            try {
                const response = await fetch(endpoint, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();
                displayResult('dataResult', data);
            } catch (error) {
                displayError('dataResult', 'Network error: ' + error.message);
            }
        }
    </script>
</body>
</html>